[[section-distributed-computing]]
== UDG Distributed Computing

=== Overview

Computing Continuum and Spatial Web Nodes.

Overall architecture of the spatial web node system, which involves both communication across HSTP protocols (query/response) as well as joining nodes together to create ad-hoc super nodes (i.e., spatial web federation).

Structure of the Spatial Web Node, including the primary hstp.d and hsml.d daemons, the domain graph, a credential graph, and a schema graph.

Bridging HSTP and UDG scopes (handled through hstp.d and hsml.d respectively)

Managing internal local hstp.d clocks (repeating internal events) to manage query and updates against live resources.

Place, Person, Thing and SW Node registry for commonly referenced entities (the Spatial Web registry)

[[computing_continuum]]
.Distributed computing continuum
image::computing_continuum.png[Distributed computing continuum]


=== Moving a DOMAIN between UDG Nodes

Links are one of the few actions that can cross spacial web node boundaries.  Activating the link initiates a sequence of steps:

* Negotiate a challenge that checks to make sure that the agent can be moved.
* Identify if the agent has a corresponding swid on the new system. If not, create one.
* Copy the metadata for that agent in the graph of the new server.
* Attach the agent to the indicated place within the new domain.
* Notify the current server that the agent has been successfully replaced.
* Deactivate the agent on the current node (not remove, just deactivate) if the transfer was successful, otherwise send a note to the actor of the current agent that the link failed.

This is more complex than moving within a given node because the latter simply requires changing pointers.


include::09-01-design-spatial-web-node.adoc[leveloffset=+2]

include::09-02-node-registries.adoc[leveloffset=+2]

include::09-03-udg-and-hstp.adoc[leveloffset=+2]

include::09-04-use-cases.adoc[leveloffset=+2]



==== Clients and Representations

A __map__ has a very general meaning in HSML: it is a ___representation___ of a
domain. A domain is a restful entity - it has an internal representation within
the associated graph- but for a number of reasons the graph that gets produced
when a request is made about a domain or other entity will likely not be
identical to the internal graph, but will rather be a computed graph (as JSON-LD
or similar structure).

There are three alternative approaches that can be taken with regard to
representation.

===== Thin Client (Declarative - Wave 1)

This was the original approach taken with the web from about 1993 to the early
2000s. In this case, HTML was the declarative language that defined the
structure of a web document, and while there was a limited amount of interaction
via scripting (Javascript arrived in December 1995), for the most part the
client experience tended to vary from browser to browser. Significantly, it
should also be noted that most documents were comparatively small and self
contained, meaning that all of the state of that document could be transmitted
as a single message.

===== Thick Client (Imperative - Wave 2)

This approach had its heyday from about 2005 to around 2022, and primarily
involved the increasing use of Javascript to build applications of increasing
complexity, while at the same time, building on increasing standardization on
both core functionality (e.g., ECMAScript) and the increased modularization of
defineable web components. In general, this approach works best for a clearly
defined client - the browser page in effect acting as a platform for development
of specialized clients.

===== Thin Client Streaming (Declarative - Wave 3?)

This is the rise of the chat interface - in essence a continuous stream of
information that emerges as part of the prompt/response pattern inherent with
LLMs and GenAI systems. This approach shifted the interface from being primarily
static and fixed to one that reflected a continuous update, and has since
shifted into a multimodal design pattern involving just-in-time editors being
launched to create or edit objects that are generated as artifacts.

Ideally, the spatial Web should support all three of these modalities. There are
two aspects that are important in all of these, however. First is the fact that
the Spatial Web is temporal in nature as well as spatial - a typical application
will not make one query against a particular system, but more than likely will
continuously ask for changes in the state of that system. In essence, a
connection is stateful, reporting the state of a system repeatedly until it is
told not to. At the same time, there is a compelling use case for providing a
historical rendition of a given domain or agent as it changes over time.

This implies that the third case - streaming - will like be a major use case,
which is actually one of the key advantages of using RDF. A typical interchange
in this scenario may be as follows:

[source,mermaid]
----
---
config:
  theme: redux
---
sequenceDiagram
  actor client as Spatial Web<br>Client
  actor swnode as Spatial Web<br>Node
  actor domain as Spatial Web<br>Domain
  autonumber
  client ->> swnode: Open connection to domain
  swnode ->> domain: Validate and Connect
  domain ->> swnode: Connected
  swnode ->> client: Connected and Open
  client ->> domain: Get Map
  domain ->> client: Full State of Map
  loop  Every second
    domain ->> client: Update of Map
  end
  client ->> domain: Stop Get Map
  domain ->> client: Return summary
  client ->> domain: Close connection
  domain ->> swnode: Connection closed
  swnode ->> client: Connection closed
----

In this particular case, the user requests an hsml:Map object (not currently
defined) which can be represented as a JSON instance or Turtle stream that gives
the current state of the domain, then periodically a delta indicated a state
change. For the apartment as an example, the map would indicate the full state
of the map domain as given above (assuming the user has the correct
permissions). Thereafter, the domain will send messages along the lines of:

----
<<__:JaneDoe hsml:hasLocation (7,3) >> hsml:message [ hsml:status hsml:DeleteNode;
hsml:time "2025-08-04T09:10:11"^^xsd:dateTime ;
].
<<__:JaneDoe hsml:hasLocation (8,4) >> hsml:message [
hsml:status hsml:AddNode;
hsml:time "2025-08-04T09:10:11"^^xsd:dateTime ;
].
----

where `:JaneDoe` resolves to the internal identifier for the agent, and `<<...>>` indicates a reifier for the statement.

To summarize, the client requests that the Spatial Web Node opens a connection
to a domain, handing back the channel key for that domain to the client for
direct communication. Once the key is open, the client requests a map (i.e,
descriptive representations) that gives the relevant queried context for the
domain in question as a structure, then, as the environment changes, provides
updates to the map indicating when resources have changed.

When the client sends a message to stop, the server will stop the update and
generate a new whole map that reflects the state of the domain at the end of the
run.

Note that this process can be interspersed with commands to the representative
agent within the domain. The commands coming from the client do not directly
change the state of the domain. Rather they indicate to the domain that the
agents should be directed to change their configuration to either achieve the
goal or determine that they can't achieve the goal. An internal loop then
manages the updates to the graph to set the relevant changes in state within the
various agents in the domain.

Note that this approach can also work well when you have multiple agents that
are interacting in the same domain, driven by different external clients (or
internal autonomous agents).

==== Icons

The Spatial Web by itself is not meant as a vehicle for transmitting imagery or
3D models, but because what it does generate are descriptions of physical
systems, it is frequently desireable to have some way of indicating to a spatial
web client how it should represent the entity in a map or projection. This is
the role of icons, as represented by an `hsml:Icon` entity.

An __icon__ is an entity with a reference to either an internal or external
media source, likely in the form:

----
[] a hsml:Place ;
     hsml:topic <#concept/Countries/Canada>
     hsml:hasIcon [
        hsml:href <#images/maps/Canada.jpg> ;
        hsml:hasMediaType <#concept/mediaTypes/Image> ;
     ] .
[] a hsml:Agent ;
     hsml:topic <#concept/People/JaneDoe>
     hsml:hasIcon [
        hsml:href <#images/icons/JaneDoe.jpg> ;
    ] .
[] a hsml:Agent ;
     hsml:topic <#concept/Building/EiffelTower>
     hsml:hasIcon [
        hsml:href <#images/icons/EiffelTower.png> ;
        hsml:hasMediatype <#concept/mediaType/Image>
    ], [
        hsml:href <#models/icons/EiffelTower.obj> ;
        hsml:hasMediatype <#concept/mediaType/3DModel>
    ] .
----

The `hsml:href` is a pointer to the media resource in question, while
`hsml:mediaType` indicates which media type it is used. This may be inferred
based upon the extension in the href resource if this is known (as in the second
example). The media type is used primarily to indicate to the user client how
the resource should be displayed.

For instance, in the third example, you have an agent representing the Eiffel
Tower in Paris, France. If the user client is a 2D browser, then this may be
represented as a transparent PNG file on top of a map. On the other hand, if the
client is a 3D browser, this may be represented using the EiffelTower.obj 3D
model.

Icons can maintain positional and orientation information appropriate to the
entity. The goal with such icons is not necessarily to provide a precise
representation or rendering, but rather to provide to the user agent a way of
constructing an approximate representation to indicate symbolic relationships.

Note that a given entity may include both an icon and a link. The link is an
abstraction on the entity, not the icon.


=== Directory Domain and Home Places

A spatial web node can identify a particular domain that serves as it's
directory domain. If no domain is specified by an hstp request, this will be the
default domain. This domain is designed to provide a directory or catalog of the
domains that are accessible to a given external agent based upon their
credential profile, and also provides mechanisms to "sign in" if this is
required to change the domains that they see.

Similarly, within every domain, there is the option of specifying a home place.
This is where agents are positioned when they first "enter" a given domain, if
no domain is otherwise specified. In simple scenarios (such as the smart room
scenario), there may be only one place in the domain, but in more complex
scenarios (especially those representing tours or rpgs), this home place
typically also serves the role of establishing context and backstory for the
agent, providing instructions for interacting with the domain, and identifying
pertinent "destinations".


==== Spatial Web Addresses

In the Spatial Web, there is a distinction between a Spatial Web Identifier
(SWID) and a ___Spatial Web URL___ (here, proposed as __SWURL__). The SWID
provides an address to a credential that verifies the existence of that
resource, but does not in fact identify where a resource is within the spatial
web. This makes it far more difficult to create a linking system as such
credentials are not necessarily guaranteed to be within the same indexing
system.

___Addressing__ and ___credentialing__ serve two different functions. A
__spatial web resource locator__ (or SWURL) identifies where a given resource is
located on the spatial web. The address typically will identify a spatial node
(the physical system where the resource is located) coupled with an identifier
for that resource on that machine.

A SWAD does not make any guarantees by itself about the verifiability of the
address (this is the role of the SWID), nor does it identify the resource
semantically. Instead, the SWURL is a label that locates the resource on the web
itself.

Just as a resource has a SWID, it also has a SWURL. The SWURL is a ___local
name___ that is assigned to the resource in question, utilizing HTTP naming
conventions. A resource may have more than one SWAD, or none. If a resource has
no SWURL, then the SWURL defaults to the portion of the SWID after the
"did:swid:" method. If a resource has multiple SWRLs, then any of these can be
used to reference that resource.

The UGD.d resolves local SWRLs and returns the resource in question, but only
after it verifies credential access for that resource via its SWID, returning an
Unverified Access Error if the resource fails its credential check.

For instance, if the spatial web node has a SWURL of:

----
https://mySmartRoom.com:8200
----

with 8200 indicating the port number where the hstp.d daemon is located (there
is no port specifically dedicated to the spatial web, but it would be a good
idea to be thinking about this), then resources that are defined on that node
(such as domains, agents, scripts, etc.) can be further accessed by normal http
qualification methods, such as:

----
https://mySmartRoom.com:8200#agent-light-123
----

If done with a content type of `application/hsml+json`, this would retrieve an
HSML description giving the relevant details of the resource in JSON-LD (not
necessarily the internal one-to-one encodings - the internal graph exists not
for commonality but for state management). If the content type is `text/html`
then what gets returned is a summary of that resource or system in an HTML
format, and so forth.

Internally, this same entity is represented as a graph, quite possibly one given
as a blank node:

[source,turtle]
----
# Turtle
prefix hsml: <http://spatialwebfoundation.org/hsml#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
prefix swid: <did:swid:>
@base: <https://mySmartRoom.com>

[] a hsml:Agent;
    hsml:swid swid:3195A951EF1109 ;
    hsml:swrl <#agent/light-123> ;
    rdfs:label "Light 123" ;
    .
----

The notation <agent/light-123> for the swrl is indicative that (at least in
RDF) this is an IRI fragment relative to the containing spatial web node.

A __blank node__ is a node that has an IRI that is defined within a graph, but
is not defined globally. This structure makes it possible within Turtle to write
something like:

[source,turtle]
----
# Turtle
prefix hsml: <http://spatialwebfoundation.org/hsml#>
prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
prefix swid: <did:swid:>
@base: <https://mySmartRoom.com>

[] a hsml:Domain ;
    hsml:swid swid:EA519DEFFC1235 ;
    hsml:swrl <#domain/lightRoomScenario> ;
    hsml:hasAgent [
        a hsml:Agent;
        hsml:swid swid:3195A951EF1109 ;
        hsml:swrl <#agent/light-123> ;
        rdfs:label "Light 123" ;
        ]  .

----

The domain and agent SWRLs in this scenario then resolve to:

----
    # Domain SWURL
    <https://mySmartRoom.com#domain/lightRoomScenario>
    # Agent SWURL
    <https://mySmartRoom.com#agent/light-123>
----

Every spatial web node has a distinct base, and for the most part, resources are
defined relative to those nodes. This is a bit of a departure from the normal
best practices for the semantic web, but the distinction here is that most
spatial web resources are effectively local to their nodes. Because a given
resource can have multiple SWRLs, this also implies that most references will be
indirect - "give me the (graph) node that has this SWURL", just as one would say
"give me the (graph) node that has this SWID".

One other key point - the spatial web does not recognize URL parameters being
passed as part of a GET request - if you need to pass parameters, these should
be passed as the body of a POST request. This keeps the address space clean,
makes it easier to validate incoming requests, and is more consistent with
regards to semantic web principles.

===== Home Domains

There is a chicken and egg situation with regard to whether a given Spatial Web
Node can be considered an agent or a domain. To get around this, there is a
specific exception to the idea that all agents exist on places within domains.
There is assumed to be on a given spatial web node a designated Home Domain that
is explicitly stated to be associated with the node itself. It's "agency" in
this particular case is the action of the node daemons, with specific
capabilities. When a spatial web node is first set up, this home domain/agent
holds the configuration metadata for the node itself, as well as any credentials
that are specific to the node.

Put another way, ___from the standpoint of the UDG, the Spatial Web Node is a
domain, with an implicit super agent___. The mechanics of this are still to be
determined.

==== Affiliation Networks

An __affiliation network__ is a network of spatial web nodes which shares common
resources, taxonomic classifications and typically a common registry. The
registry serves as the hub of the network, identifying membership in the
affiliation network as well as providing a mechanism for discovery within that
network.

One of the roles of a registry is to issue and affiliation credential. This
credential serves as a way of verifying that nodes within the network are in
fact part of that network, and provide permissions that spatial web clients need
to have in order to access certain features.

For instance, a group of universities in a given region may establish an
affiliated network. This means that each university effectively agrees to abide
by specific taxonomies as a way of organizing information, provides common set
of activities for performing such tasks as transferring students between
universities, enrolling in classes, and so forth, and will often allow students
and faculty from one university to access resources or get consistent grading at
other universities within the affiliation.

This is accomplished through a "university league" credential which is issued
when the node is added to the network. When a student registers to a given node,
their user agent (the software client they interact with) within the system
receives a corresponding private key credential that both makes the user a
resource in the system and provides them access to that system.

This serves a number of functions. For instance, an administrator can perform an
affiliation level search for a given student, faculty member, class, or program
(among many other things), either by ID or by attributes. A student can register
with another university within the affiliation to take a class remotely, or can
even sign up to and use remotely controlled laboratories stations (such as
observatory time at a telescope or participation within a collaborative
concert). A teacher can make available resources such as books or training
videos from protected repositories to all of her students.

In this particular case, the registry serves to identify those domains within
the network of nodes of affiliated members that may contain the desired
resources. When a query is made in the broader context of the affiliation, each
of these affiliated nodes are then queried in turn and return the associated
links to those resources as a structure (analogous to an RSS or Atom type
structure) that are then collated by the calling domain.

Note that the nodes in these affiliated networks are not (typically) graph
extensions. A graph extension expands the active domain graph of a given node
and is normally secured, because it exposes all resources within that graph. An
affiliation query, on the other hand, is a request for information (typically
links but also maps) from other nodes in the affiliated network.

[source,mermaid]
----
---
config:
  layout: elk
---
flowchart TD
  subgraph SWRAF[Spatial Web Affiliation]
      subgraph ULN[University Network]
         direction TB
            Oxbridge1[<b>Domain</b><br>Oxbridge University]
            Camford[<b>Domain</b><br>Camford University]
            Eden[<b>Domain</b><br>Eden University]
            Queens[<b>Domain</b><br>Queens College]
      end
      subgraph CL[College Rugby League]
         direction TB
         Oxbridge2[<b>Domain</b><br>Oxbridge University]
         Amhurter[<b>Domain</b><br>Anhurter]
         Chancery[<b>Domain</b><br>Chancery]
      end
      Oxbridge1 -.- Oxbridge2
      ulna[<b>Domain</b><br>University League Registry]
      cla[<b>Domain</b><br>College Rugby Registry]
      ulna -->ULN
      cla -->CL
  end
  swra[<b>Domain</b><br>Spatial Web Registry]
  swra -->SWRAF

  style SWRAF fill:#FFFFF8
----

Here, Oxbridge University is part of two affiliation networks - a university
network and a rugby league network.




=== Security and Credentials

A central part of the Spatial Web is the use of secure credentials in order to
maintain ___surety___ within the web, where __surety__ can be defined as the
verification that an assertion being made about a particular entity was valid.

Surety is made possible through the use of credentials that can be issued both
by spatial web nodes that identify that specific resources have been created by
that node, as well as assertions made by external authorities that a given agent
has the relevant credentials to perform specific activities pursuant to a
contract.

The mechanism that binds these credentials is the __Spatial Web Identifier__ (or
__SWID__), which is a specific key that references a credential ___within___ the
Spatial Web Node. This key is a ___decentralized identifier___ (or __DID__)
according to the <<w3c_did_core,W3C DID Core Specification>>. All DiDs issued by
a spatial web node are further considered to have a SWID method that indicates
that such credentials follow the Spatial Web standard (D3.3.1). The specific
format for such credentials is still being worked out.

==== Credential Stores and Addresses

The __credential.d__ daemon is responsible for both the issuance of SWIDs as
well as the resolution of SWIDs. It is _recommended_ that each Spatial Web node
maintains a specific cache of credentials that are issued by it as part of the
domain graph architecture, with the SWIDs then being treated as identifiers by
the system to those credentials.

A credential in this particular case can serve primarily as a passthru reference
to an external DiD that has a specific issuer that can be resolved within the
internal SW Credential structure, and which utilizes a separate addressing
mechanism (such as https) to identify the location of the issuing server _if
that server is not the current spatial web node_.

A SWID is ___not___ a ___Spatial Web URL___ (__SWURL__). The SWID serves to
either identify the credential within the current Spatial Web Node or, through
reference, to point to the location of an issuing server, while the SWURL
provides an address (a ___Uniform Resource Locator___ or ___URL___) to a
resource within the broader spatial web network, which in turn may have a SWID
to its relevant credential.

The D3.3.1 specification indicates that all entities must have SWIDs. This
perforce indicates that all entities must have credentials. It should be noted
that not all credentials issued by the spatial web nodes _must_ be
cryptographically secure, though this may be a requirement imposed within a
future specification.

==== Credential Issuance

A Spatial Web node is able to issue credentials to all entities that it creates.
When that entity, such as a domain or agent, is created within the domain graph
for the node, the SW Node will issue a cryptographically bound SWID that is
associated with that entity and that consequently provides surety for the
existence of that entity throughout the entity's life span.

Moreover, when an entity undergoes a material change, such as an agent moving
from one domain to another which necessitates the creation of an additional
proxy between those domains, then a new credential is issued indicating the
change of "ownership" of that entity, along with a pointer indicating the
previous owner (in effect forming a transitive chain). Such SWID transfers act,
in effect, as a chain of custody for the resource.

One key point - an entity is always bound to its spatial web node. The flipside
to this is that ___each spatial web node issues its own SWIDs___. Put another
way, there is no centralized authority for the issuance of SWIDs on resources.
Instead, to find a given entity, you use the SWURL for that entity to locate it
in the Spatial Web, then you validate that the entity is as stated based upon
its credential on the indicated node.

Additionally, additional credentials can be bound to the same SWID, a key point
in making contracts work. These are typically tied into activities and norms and
often require multiple different SWID holders to create a contract with its own
SWID that binds the activities of agents together as specified by the boundaries
of the contract itself. This work is still under development.

==== Credential Revocation and Registries

Just as the Spatial Web Node is the issuer of a credential, so too can it revoke
a particular credential to indicate that the credential is no longer valid. Note
that Spatial Web Nodes can also issue credentials indicating membership by other
spatial web nodes within an affiliated network for which it acts as a registry.

This in turn means that revocation of a given spatial web node from a given
affiliation network is never accomplished by that node, but rather by the
affiliation holder, unless the registry node is also part of the affiliation
network (ie, is self registering).

EDITOR: It may be that a given registry is explicitly not a part of its own
affiliation network. This is still to be determined, as it has implications on
what a registry node can support.

Because a spatial web node has its own implicit home domain, a node can be
removed from a network by revoking the credentials of the home domain for that
machine. The machine is still findable via a URL, but the lack of credentials
mean that the request for data can't validate (it will send back an error across
hstp indicating the data won't validate).

=== Dynamic handling of links 

When a link is received by the domain manager, it uses the context determined by
these parameters to determine other necessary metadata. These are then passed to
the link's activation handler (or the defaults relevant by type) to perform the
associated link action.

Links can be set up by the domain designer via the periodicity property as one
of singleton (the link is only activated once) or periodic (the link is invoked
across a given channel periodically until either the link is terminated or the
channel's time-to-live (TTL) is exceeded). Once the link completes, it will
either be reset (the default) or it will be expired (for links that expire upon
use).

This operation is handled by the domain manager. Note that in fully autonomous
operations, open links simply cause the agent to reset to the new place (and
domain, if this changes, without UX involvement. However, key activation still
requires the relevant credentials.