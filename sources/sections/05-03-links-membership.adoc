[[relationships]]
= Relationships between ENTITIES

== Complexity of relationships

Spatial Web DOMAINS have a variety of relationships with one another, thereby reflecting the complexity of the real world and the interconnectedness of its many parts. The UDG's ability to represent and navigate arbitrarily complex relationships is central to its role as the foundational component of the Spatial Web and ensures that DOMAIN-specific data is not only coherent within itself but also in coordination with other DOMAINS.

There are several types of relationships between ENITITIES in the UDG.  The following relationships are defined in this clause: 

 * Links represent relationships between an initiator ENTITY to a receiver ENTITY
 * Portals are relationships between locations in two or more DOMAINS, providing a leap between DOMAINS
 * Membership is a relationship type that signifies that a DOMAIN is a member of a DOMAIN that is of a higher order or level
 * Situations are a set of DOMAINS currently in the context of a DOMAIN
 * Dynamic relationships bring in the notion of paths

The complexity of the relationships in the UDG can be charaterized using mereology. The approach draws on ideas from mereology (the theory of parthood relations), order theory (the study of hierarchy), and category theory (the mathematics of structure). In the Spatial Web, DOMAINS may be related in structures of arbitrary complexity. [WHO? WHERE is the clause?] discusses the complexity as hierarchy, heterarchy, and holonic as described in <<domain_relationships>>.


[[domain_relationships]]
.Mereological relationships in domain hypergraphs
[%autowidth]
|===
| Type of Relationship | Description
| Hierarchical
| * DOMAINS may be a member of one and only one upper DOMAIN. 
| * DOMAINS may not have links to other DOMAINS.   
| * Coordination between DOMAINS occurs through the Domain Authority of the DOMAIN in which the DOMAIN is a member. 
| Heterarchical
| * DOMAINS may be members of one and only one upper DOMAIN. 
| * DOMAINS may have links to other DOMAINS. 
| * Coordination between DOMAINS occurs through the Domain Authority of the upper DOMAIN and through relationships to other DOMAINS. 
| Holonic
| * DOMAINs may be members of multiple upper DOMAINS.
| * DOMAINS may have links to other DOMAINS. 
| * Coordination between DOMAINS occurs through the Domain Authority of the upper DOMAIN and through relationships to other DOMAINS.
|===
 

[[domain_relationship_types]]
.Mereological relationships in domain hypergraphs
image::domain_relationship_types.png["Figure shows three types of mereological relationships between domain hypergraphs: hierarchy, heterarchy, holonic."]


It is certain that there will be inconsistencies in the UDG, similar to inconsistencies in the WWW. Some inconsistencies will be from relationships between DOMAINS as described in this clause. Other inconsistencies will be the result of the content of DOMAINS in the UDG.  UDG operations will need to be resilient to inconsistencies in the relationships between nodes and the content of nodes.



[[links]]
== Links between ENTITIES

=== Links are relationships between ENTITIES.

A link is a relationship from an initiator ENTITY to a receiver ENTITY.  The link is part of the initiator ENTITY and indicates tat the initiator ENTITY seeks to point to the receiver ENTITY. There are no bidirectional links within the Spatial Web. All links are unidirectional (one way), but there may be analogous entities (portals) for each link that provide the corresponding link back to the original place or entity.

[[fig-room-to-room]]
.Bidirectional links between rooms
image::room-to-room.png[Links showing relationship between room domains]


// [source,mermaid]
// ----
// graph LR
//    place1[Room 1]
//    place2[Room 2]
//    place1 -->|link to room2| place2
//    place2 -->|link to room1| place1
// ----

In HSML, using RDF, a link is a subject-predicate-object triple, where the elements may be IRIs, blank nodes, datatyped literals, or triple terms.

A link implies the following information between domains:

* initiator of the link
* recipient of the link
* target of the link
* type of link (if known)
* time and location of the link
* periodicity
* duration


A link can be set to be _inactive__ and/or __hidden__. 

An inactive link is visible, but can't be activated. Inactive links may serve the purpose of being descriptive (in a way similar to an inactive option in a select control in HTML works) or may be a divider.

__Hidden Links__ are links that cause their containing entity to be invisible until a specific condition is met in the environment (such as the agent finding a magic scroll or having a certain power level).

It's also possible to have __nested links__.  _Nested Links__ are links that point to other links

Types of links are described in the remainder of this clause

EDITOR: Comments about the text above: 1. a bullet mentions "target". It's unclear why a target is needed/what it provides when you have an initiator and a receiver.  2. Statement about inactive links isn't correctly stated. Statements that follow are better (if "link" is really going to be used): "A link may be active or inactive. A link may be visible or hidden." 

EDITOR: the link types described below need to be reviewed.


=== Persistent links

Links to DOMAINS present in the DOMAIN description. These are persistent links, in that they are always available to the DOMAIN. 

=== Link Challenges and Keys

A link may be associated with a challenge query. This query must be satisfied before the link is activated. Think of this as a lock on the link. The agent must have and apply an associated key for that lock before the agent can activate the link. This metaphor is so persistent that it is easy to think of the entity containing the relevant link as a portal or door of some sort.

Note that the hosting entity of the link can query the state of that link, and present a representation of that link's status to the corresponding agent. This is different from the way that HTTP links work.

=== Bag link: AGENT carrying a DOMAIN 

One common use case in the Spatial Web occurs when an AGENT (say a truck) acts as a transport for another DOMAIN (such as a package). The package becomes linked to the truck.  The carrying capacity for the AGENT domain can be determined individually for that particular location (it may be by weight, by volume, by insurability, or by some even more exotic measure)

Each carried DOMAIN in turn has a specific credential key that can serve as a key to a portal (or other linked agent). These are connected to the carrier agent through a bag link. In effect the carrier can "borrow" the key of the carried item.

A carryable agent in that case can be "picked up" by the carrier agent and thus removed from the location within the active domain into the bag location in the carrier's domain. Even if the carrier moves to a new domain, the carried object stays associated with the carrier's internal domain "bag". The carried agent can be used by the carrier to activate a portal or similar Thing agent.

Activation of a bag link _may_ also cause the item to expire, in essence, being removed from the bag upon use. Additionally, a
carried item may be transferred to another agent or "dropped" into the current location. That has obvious implications for both supply chain scenarios and e-commerce scenarios, where a specific virtual item is "sold" to another agent, and its use in role playing games should be self-evident.

=== AGENT-to-DOMAIN Links

A use case is connecting one agent that is in effect a camera (a sensor array) with another agent that is a display or monitor. 

This could also be used to monitor the value of a given set of properties such as position, temperature, funds, or emotional state. Since in many cases, these values may be computed rather than intrinsic, this provides a light-weight mechanism for determining relevant state without needing to know the internal mechanisms for that agent.


== Portals

A __portal__ connects spaces as defined in <<IEEE_2874_2025, Spatial Web clause 6.2.3.7.2. Connecting spaces>>.  By identifying  sets of locations in hyperspace that connect two DOMAINS, a portal between the DOMAINS is created as a relationship between DOMAINS.  A portal need not be binary; it could be multiple sets of points to define an n-ary portal.  

Portals are defined using sets of points in spaces.  The sets of points might also be the locations of several domains. For example, a portal defined by locations on each side of a doorway also defines the connection of room DOMAINS which share the doorway.

A portal may be used by an AGENT to move between spaces.  The path of the agent uses the portal to move from one location to another and between domains. Such links are topological, in that such links are not necessarily dependent upon contiguity or geometry.

Portals access may be constrained by the requirement that the initiating agent has access to a cryptographic key in order to activate the portal. Such keys may be associated with dedicated agents in a Bag relationship.

A landing place is a place within a domain that is used to indicate where a given agent is placed (lands) when entering a domain without an explicit link to a place. This can be thought of as the "home" of the domain, and is indicated as a property of the domain. This corresponds roughly with the top of an HTML page when it is rendered.

Portals will take you from a place to another place, but it is possible to link to other entities. Such links will take you to the location of that entity. For instance, if you wanted to join a party (an link:aggregations.md[aggregation]), then you could use the SWID of that aggregation to take you to where that party is located, even if that party moves around. See <<links,Links>> for more details.

EDITOR: The OMA3 Inter-World Portaling System (IWPS) draft standard may be relevant for Spatial Web.  IWPS presents a framework for digital interoperability, acting as the 3D equivalent to a web hyperlink, linking users to various virtual worlds. The IWPS standard enables users to move between applications, even on different devices, effectively serving as a generic application launcher. 


== Membership in a DOMAIN

=== DOMAIN as a container of DOMAINS

A DOMAIN is a holon: it is both a unit and a composition.  As a unit or system, a DOMAIN performs functions that are only achievable as a collective whole.  As a composition, a DOMAIN contains parts which are subject to conditions on the parts enforced by the overall DOMAIN.  An AGENT is an excellent example of a DOMAIN as a system or organism.  In this clause we focus on the DOMAIN as a composition.

Membership in a DOMAIN is type of credential granted by the Domain Authority of the upper domain to the member domain.  The credential provides the evidence of the claim that a DOMAIN is a member of an upper DOMAIN.

Membership in DOMAINS may be a multi-layer hierarchy: a DOMAIN maybe included in a DOMAIN which in turn is included in a DOMAIN. 

As a holarchy, the membership relationship allows for a DOMAIN to be a member of more than one DOMAIN.

Movement of a DOMAIN in and out of membership in an upper DOMAIN is allowed as specified in the membership agreement of the DOMAIN.

=== Obligations on DOMAIN members.

DOMAINS define norms, obligations and laws which the member DOMAINS must adhere with.  Enforcement of the DOMAIN obligations is a function of the Domain Authority that manages the upper DOMAIN.

=== DOMAIN location

A DOMAIN may have a location in hyperspace.  The location may be a single point or it may be a more complex geometry, e.g., polygon, sphere, etc.

A DOMAIN location may be within an upper DOMAIN location. The DOMAIN may include sub-domains contained within the DOMAIN location.  For instance, a given planet domain may have multiple locations that represent the countries of that planet. 


== SITUATIONS

For the purposes of defining context, the SITUATION relationship is defined.  A SITUATION may be a dynamically changing relationship. 

A SITUATION relationship is a relationship ENTITY comprised of all DOMAINS that can be perceived and reasoned about by an AGENT <<IEEE_2874-2025, Spatial Web clause 6.6.4.>>.  SITUATION is to be understood as defined in [IEEE_7007_2021]: a situation is an entity comprised of participating entities and relationships that represent the limited parts of reality that can be perceived and reasoned about by agents.

A DOMAIN, in particular an AGENT, can create a SITUATION at any given moment in time.  This may include determining the visible, nearby DOMAINS and deleting DOMAINS no longer of interest. A SITUATION may be composed of:

* Location in Hyperspace
* Links to other DOMAINS that are currently active
* Membership in DOMAINS that are currently relevant
* Current presence of the AGENT within a DOMAIN which it may not be a member
* Awareness (e.g., via query) of nearby DOMAINS of interest to the AGENT with which it may not have any current relationship.



== Dynamic relationships - paths

=== Updating relationships with time and activity

An ACTIVITY is a partially ordered set of changes effected by an AGENT. An ACTIVITY may affect the relationships for a DOMAIN, including adding or deleting links, joining or leaving membership in a DOMAIN, and/or, affecting the member ENTITIES of a SITUATION.

An AGENT may move between DOMAINS.  An AGENT may be present in a DOMAIN without being a member.  The AGENT may be present in a DOMAIN and then move to another DOMAIN.  


=== Constrained paths for change

EDITOR: are paths between domains constrained?  The following text addressing constrained movement as paths needs to be reviewed.

To go from one location to another, an AGENT has to traverse a path.

Note that there are two distinct actions that can be taken, selection and path traversal. If a location can be __selected__, it identifies that location as being part of an active set of location. If it is __activated__, then the path is traversed as described above.

A ___portal___ that is applied to a given path (styled as a door or other kind of portal), that causes the activating agent (such as a player character in a game) to move to a different, specified location:

[[links-game-example]]
.Example of relationships between entities
image::links-game-example.png[example of link between entities]


// [source,mermaid]
// ----
// graph LR
//     portal1-1[fa:fa-door-open<br><b>Agent</b><br>Portal]:::agent
//     pc1-1[fa:fa-chess-pawn<br><b>Agent</b><br>Player Character]:::agent
//     room1-1[fa:fa-map-marker-alt<br><b>Place</b><br>Room 1]:::place
//     room2-1[fa:fa-map-marker-alt<br><b>Place</b><br>Room 2]:::place
//     activity1-1[fa:fa-bolt <br><b>Activity</b><br>Transfer Agent]:::activity
//     credential1-1[fa:fa-wallet <br><b>Credential</b><br>Traversal Document]:::credential
//     link1-1[fa:fa-link<br><b>Link</b><br>Link]:::swlink
//     link1-1 -->|initiating agent| pc1-1
//     link1-1 -->|targeted agent| pc1-1
//     link1-1 -->|from| room1-1
//     link1-1 -->|to| room2-1
//     link1-1 -->|has activity| activity1-1
//     link1-1 -->|requires credential| credential1-1
//     portal1-1 -->|has link| link1-1
//     pc1-1 -->|has credential| credential1-1
//
//  classDef swlink fill:orange
//  classDef agent fill:lightBlue
//  classDef place fill:lightGreen
//  classDef activity fill:yellow
//  classDef credential fill:ivory
// ----


For an AGENT to traverse a path means moving from one location to another following a particular path of intervening locations. This approach is straightforward and especially conducive to optimization of path traversals to minimize energy expenditure, though as the number of locations goes up, so too does the complexity of such computations.

In the real world, of course, we do not hop from location to location but move in a continuous fashion, and a robot or physical twin has to determine the "how" of traversal. This process may live in the interface between the virtual and physical twin.

In general, this information may be stored in metadata that is associated with the link, but that is outside of the scope of the spatial web. For instance, a robot needs to move from the bottom of a hill to the top of a hill along a road. The link may indicate characteristics of the hill - its inclination in particular - but from the standpoint of the Spatial Web, this slope is a challenge that has to be met prior to achieving the key to allow the transition from one location (the bottom of the hill) to another (the top of the hill).

In this case, the path challenge would be to solve a physics problem - is the weight of the robot, the power of the motor, and the inclination of the slope sufficient to reach the top, and are there any routes (sequences of locations) that the robot can take if the slope is too challenging? If the problem is solved, then the robot goes ahead with the selected route, otherwise, the lock remains locked.

For a sufficient large hyperspace, the mesh of potential paths can more closely represent a curve. For instance, the road may be treated as a space with a fairly high density of hexes, and rather than trying to tackle the road head-on in a linear fashion, it ascends the road as a series of switchbacks (much like a sailboat tacking against the wind).

[[fig-tacking]]
.Tacking as movement in a cellular space
image::tacking.png[Tacking]

In the case where there is a physical twin bound to an agent, the path remains active until the physical twin indicates it has successfully completed the task, at which point it may update the SITUATION associated with the agent with physical coordinates that can be translated back into tiling.

This means that in general the physical location of a tile may be its centrum, unless this is specifically overrriden with a centrum property.

This analogy also corresponds with non-Hilbert spaces, such as heat/pressure state regimes. In this case, the tiles represent specific regimes of behavior for the system, as the agent (or token) moves from one such state to the next. In the real world, these transitions are usually analog and may be subtle, but modeling these as a state diagram can be useful:


[[fig-ice-steam-plasma]]
.Transitions of state between ice, steam, plasma
image::ice-steam-plasma.png[Transitions of state between ice, steam, plasma]

// [source,mermaid]
// ----
// ---
// config:
//    layout: elk
// ---
// graph LR
//    perovskite[Perovskite]
//    ice[Ice]
//    liquidWater[Liquid Water]
//    steam[Steam]
//    plasma[Plasma]
//    perovskite <--> ice <-->liquidWater <--> steam <--> plasma
//    ice <--> steam
// ----

The agent's position across the hyperspace of locations indicates what state the agent is in, where the agent can be seen as a marker for the current state.

== Requirements and recommendations

TBD
